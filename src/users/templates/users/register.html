{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'intl-tel-input/css/intlTelInput.css' %}">
<script src="{% static 'intl-tel-input/js/intlTelInput.min.js' %}"></script>
<script src="{% static 'intl-tel-input/js/utils.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<body>
<div class="cinemas-wrapper">
    <div class="container mt-5">
        <h1 class="mb-4 text-center">Реєстрація</h1>
        <form id="registrationForm" method="post" action="{% url 'register' %}">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-6">
              <div class="mb-3 row align-items-center">
                <label for="firstName" class="col-sm-4 col-form-label">Ім'я</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="firstName" name="name" aria-label="First name">
                  <div class="text-danger" id="nameError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="lastName" class="col-sm-4 col-form-label">Прізвище</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="lastName" name="last_name" aria-label="Last name">
                  <div class="text-danger" id="lastNameError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="nickname" class="col-sm-4 col-form-label">Нікнейм</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="nickname" name="nickname" aria-label="Nickname">
                  <div class="text-danger" id="nicknameError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="email" class="col-sm-4 col-form-label">Email</label>
                <div class="col-sm-8">
                  <input type="email" class="form-control" id="email" name="email" aria-label="Email">
                  <div class="text-danger" id="emailError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="address" class="col-sm-4 col-form-label">Адреса</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="address" name="address" aria-label="Address">
                  <div class="text-danger" id="addressError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="password" class="col-sm-4 col-form-label">Пароль</label>
                <div class="col-sm-8">
                  <input type="password" class="form-control" id="password" name="password1" aria-label="Password">
                  <div class="text-danger" id="password1Error"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="rePassword" class="col-sm-4 col-form-label">Повторити пароль</label>
                <div class="col-sm-8">
                  <input type="password" class="form-control" id="rePassword" name="password2" aria-label="RePassword">
                  <div class="text-danger" id="password2Error"></div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3 row align-items-center">
                <label class="col-sm-4 col-form-label">Мова</label>
                <div class="col-sm-8 d-flex align-items-center">
                  <div class="form-check me-3">
                    <input class="form-check-input" type="radio" name="language" id="languageUkr" value="ua" {% if form.language.value == "ua" %}checked{% endif %}>
                    <label class="form-check-label" for="languageUkr">УКР</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="language" id="languageRus" value="ru" {% if form.language.value == "ru" %}checked{% endif %}>
                    <label class="form-check-label" for="languageRus">РУ</label>
                  </div>
                  <div class="text-danger" id="languageError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label class="col-sm-4 col-form-label">Стать</label>
                <div class="col-sm-8 d-flex align-items-center">
                  <div class="form-check me-3">
                    <input class="form-check-input" type="radio" name="gender" id="genderMale" value="M" {% if form.gender.value == "M" %}checked{% endif %}>
                    <label class="form-check-label" for="genderMale">Ч</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="F" {% if form.gender.value == "F" %}checked{% endif %}>
                    <label class="form-check-label" for="genderFemale">Ж</label>
                  </div>
                  <div class="text-danger" id="genderError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="dob" class="col-sm-4 col-form-label">Дата народження</label>
                <div class="col-sm-8">
                  <input type="date" class="form-control" id="dob" name="date_birthday" value="{{ form.date_birthday.value }}">
                  <div class="text-danger" id="dateBirthdayError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="city" class="col-sm-4 col-form-label">Місто</label>
                <div class="col-sm-8">
                  <select class="form-select" id="city" name="city" aria-label="City">
                    <option selected>Оберіть місто</option>
                    {% for city in cities %}
                    <option value="{{ city }}" {% if form.city.value == city %}selected{% endif %}>{{ city }}</option>
                    {% endfor %}
                  </select>
                  <div class="text-danger" id="cityError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="cardNumber" class="col-sm-4 col-form-label">Номер карти</label>
                <div class="col-sm-8">
                  <input type="text" class="form-control" id="cardNumber" name="num_card" aria-label="Card number" value="{{ form.num_card.value }}">
                  <div class="text-danger" id="cardNumberError"></div>
                </div>
              </div>
              <div class="mb-3 row align-items-center">
                <label for="phoneNumber" class="col-sm-4 col-form-label">Телефон</label>
                <div class="col-sm-8">
                  <input type="tel" class="form-control" id="phoneNumber" name="phone" aria-label="Phone number" value="{{ form.phone.value }}">
                  <div class="text-danger" id="phoneError"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="text-center mb-2">
            <button type="submit" class="btn btn-primary">Зареєструватись</button>
          </div>
        </form>
    </div>
</div>

<script>
  var input = document.querySelector("#phoneNumber");
  window.intlTelInput(input, {
    initialCountry: "ua",
    utilsScript: "{% static 'intl-tel-input/js/utils.js' %}"
  });

  $('#registrationForm').on('submit', function(event) {
    event.preventDefault();
    var formData = $(this).serialize();

    // Clear previous error messages
    $('.text-danger').empty();

    $.ajax({
      type: 'POST',
      url: $(this).attr('action'),
      data: formData,
      success: function(response) {
        if (response.form_is_valid) {
          window.location.href = response.redirect_url;
        } else {
          // Display errors
          var errors = response.errors;
          for (var field in errors) {
            $('#' + field + 'Error').text(errors[field]);
          }
        }
      }
    });
  });
</script>
</body>
{% endblock %}
